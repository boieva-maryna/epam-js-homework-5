const plants=[{
        'id':'0',
        'name':'Aloe Vera In Mini Dolores Planter',
        'img':'img/Aloe-Vera_1.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#FDF4EC',
                'color_name':'cream',
                'img':'img/Aloe-Vera_1.jpg',
                'default':'true'
            },
            {
                'color':'#EE6656',
                'color_name':'pale red',
                'img':'img/Aloe-Vera_2.jpg'
            },
            {
                'color':'#8E9C72',
                'color_name':'sage',
                'img':'img/Aloe-Vera_3.jpg'
            }
        ],
        'price':'22$'
    },
    {
        'id':'1',
        'name':'Air Plant Trio In Tillandz Stand Planter',
        'img':'img/Airplants.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'50$',
    },
    {
        'id':'2',
        'name':'Hoya Heart In Ezra Planter',
        'img':'img/Hoya-Kerrii_3.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#B3C4BE',
                'color_name':'light blue',
                'img':'img/Hoya-Kerrii_1.jpg'
            },
            {
                'color':'#e5ad93',
                'color_name':'blush',
                'img':'img/Hoya-Kerrii_2.jpg'
            },
            {
                'color':'#CC6A4B',
                'color_name':'sonora',
                'img':'img/Hoya-Kerrii_3.jpg',
                'default':'true'
            },
            {
                'color':'#4c4746',
                'color_name':'black',
                'img':'img/Hoya-Kerrii_4.jpg'
            },
            {
                'color':'#FDF4EC',
                'color_name':'cream',
                'img':'img/Hoya-Kerrii_5.jpg'
            }
        ],
        'price':'21$'
    },
    {
        'id':'3',
        'name':'Monstera In Medium Grant Planter',
        'img':'img/Monstera.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'55$'
    },
    {
        'id':'4',
        'name':'Philodendron Green In Grant Ceramic Planter',
        'img':'img/Wax-plant.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'32$'
    },
    {
        'id':'5',
        'name':'Snake Laurentii Fiberglass Floor Planter',
        'img':'img/Snake_1.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#e5ad93',
                'color_name':'blush',
                'img':'img/Snake_1.jpg',
                'default':'true'
            },
            {
                'color':'#ffffff',
                'color_name':'white',
                'img':'img/Snake_2.jpg',
            }
        ],
        'price':'130$'
    },
    {
        'id':'6',
        'name':'ZZ Plant-6',
        'img':'img/Zamioculcas.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'25$'
    },
    {
        'id':'7',
        'name':'Pothos Neon',
        'img':'img/Pothos.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'15$'
    },
    {
        'id':'8',
        'name':'Pilea Peperomioides',
        'img':'img/Pilea.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'20$'
    },
    {
        'id':'9',
        'name':'Calathea Pinstripe In Mini Hyde Planter',
        'img':'img/Calathea Pinstripe_2.jpg',
        'available':'false',
        'pot_colors':[
            {
                'color':'#e2b641',
                'color_name':'mustard',
                'img':'img/Calathea Pinstripe_2.jpg',
                'default':'true'
            },
            {
                'color':'#EE6656',
                'color_name':'pale red',
                'img':'img/Calathea Pinstripe_1.jpg'
            },
            {
                'color':'#8E9C72',
                'color_name':'sage',
                'img':'img/Calathea Pinstripe_3.jpg'
            }
        ],
        'price':'43$'
    },
    {
        'id':'10',
        'name':'Parlor Palm',
        'img':'img/Parlor Palm.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'14$'
    },
    {
        'id':'11',
        'name':'Air Plant Trio in Andes Stands',
        'img':'img/Air Plant Trio.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'50$'
    },
    {
        'id':'12',
        'name':'Money Tree In Olmsted Planter',
        'img':'img/Money Tree_1.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#B3C4BE',
                'color_name':'light blue',
                'img':'img/Money Tree_1.jpg',
                'default':'true'
            },
            {
                'color':'#e5ad93',
                'color_name':'blush',
                'img':'img/Money Tree_2.jpg'
            },
            {
                'color':'#4c4746',
                'color_name':'black',
                'img':'img/Money Tree_3.jpg'
            },
            {
                'color':'#FDF4EC',
                'color_name':'cream',
                'img':'img/Money Tree_4.jpg'
            }
        ],
        'price':'42$'
    },
    {
        'id':'13',
        'name':'Alocasia Polly',
        'img':'img/Alocasia Polly.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'16$'
    },
    {
        'id':'14',
        'name':'Bird’s Nest Fern',
        'img':'img/Bird Nest.jpg',
        'available':'true',
        'pot_colors':[],
        'price':'25$'
    },
    {
        'id':'15',
        'name':'Philodendron Silver',
        'img':'img/Philodendron.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'14$'
    },
    {
        'id':'16',
        'name':'ZZ Plant',
        'img':'img/ZZ plant.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'18$'
    },
    {
        'id':'17',
        'name':'Rubber Tree in medium dolores Planter',
        'img':'img/Rubber Tree_1.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#B3C4BE',
                'color_name':'light blue',
                'img':'img/Rubber Tree_3.jpg',
            },
            {
                'color':'#e5ad93',
                'color_name':'blush',
                'img':'img/Rubber Tree_2.jpg'
            },
            {
                'color':'#4c4746',
                'color_name':'black',
                'img':'img/Rubber Tree_1.jpg',
                'default':'true'
            },
            {
                'color':'#FDF4EC',
                'color_name':'cream',
                'img':'img/Rubber Tree_4.jpg'
            }
        ],
        'price':'42$'
    },
    {
        'id':'18',
        'name':'Succulent Assortment',
        'img':'img/Succulent Assortment.jpg',
        'available':'false',
        'pot_colors':[],
        'price':'30$'
    },
    {
        'id':'19',
        'name':'Echeveria Lola in ezra Planter',
        'img':'img/Echeveria_2.jpg',
        'available':'true',
        'pot_colors':[
            {
                'color':'#B3C4BE',
                'color_name':'light blue',
                'img':'img/Echeveria_5.jpg'
            },
            {
                'color':'#e5ad93',
                'color_name':'blush',
                'img':'img/Echeveria_4.jpg'
            },
            {
                'color':'#CC6A4B',
                'color_name':'sonora',
                'img':'img/Echeveria_3.jpg',
            },
            {
                'color':'#4c4746',
                'color_name':'black',
                'img':'img/Echeveria_1.jpg'
            },
            {
                'color':'#FDF4EC',
                'color_name':'cream',
                'img':'img/Echeveria_2.jpg',
                'default':'true'
            }
        ],
        'price':'23$'
    },
];
class Plant{
    constructor(plant_info){
        this.data=plant_info;
        this.element;
        this.imgWr=document.createElement('div');
        this.slider;
        this.controls;
        this.textColors;
        this.title;
        this.price;
        this.isAvailable;
        this.createElement();
    }
    createElement(){
        this.element=document.createElement('article');
        this.element.classList.add('plant');
        this.imgWr.classList.add("plant_img");
        this.element.appendChild(this.imgWr);
        this.createTitle();
        this.element.appendChild(this.title);
        this.createPrice();
        this.element.appendChild(this.price);
        if(this.data.pot_colors.length>0) {
            this.createSlider();
            this.createControls();
            this.creteTextColors();
            this.element.appendChild(this.controls);
            this.element.appendChild(this.textColors);
        }
        else {
            this.createImg();
            this.slider=null;
            this.controls=null;
            this.textColors=null;
        }
        this.createIsAvailable();
        this.element.appendChild(this.isAvailable);
    }
    createTitle(){
        this.title=document.createElement('h3');
        this.title.innerHTML= this.data.name;
    }
    createPrice(){
        this.price=document.createElement('p');
        this.price.classList.add('plant_price');
        this.price.innerHTML=this.data.price;
    }
    createImg(){
        const imgEl=document.createElement('img');
        imgEl.src= this.data.img;
        imgEl.setAttribute('alt',name);
        this.imgWr.appendChild(imgEl);
    }
    createSlider(){
        let pot_colors=this.data.pot_colors;
        this.slider=document.createElement('div');
        this.slider.classList.add("plant_slider");
        this.slider.style.width=100*pot_colors.length+'%';
        pot_colors.forEach((el,index)=>{
            const img=document.createElement('img');
            img.src=el.img;
            img.style.width=100/pot_colors.length+"%";
            this.slider.appendChild(img);
            if(el.default) {
                this.slider.style.marginLeft='-'+index*100+'%';
            }
        });
        this.imgWr.appendChild(this.slider);
    }
    createControls(){
        let pot_colors=this.data.pot_colors;
        let id=this.data.id;
        this.controls=document.createElement('form');
        this.controls.classList.add('color-choice');
        pot_colors.forEach((el,index)=>{
            const radio=document.createElement('input');
            radio.type='radio';
            radio.id=el.color_name+id;
            radio.name= id;
            radio.onchange=this.setSlider.bind(this);
            if(el.default) radio.checked='true';
            const label=document.createElement('label');
            label.setAttribute('for',el.color_name+id);
            radio.dataset.number=index;
            label.style.background=el.color;
            this.controls.appendChild(radio);
            this.controls.appendChild(label);
        });
    }
    creteTextColors(){
        let pot_colors=this.data.pot_colors;
        this.textColors=document.createElement('span');
        this.textColors.classList.add('plant_pots');
        this.textColors.innerHTML=pot_colors.length+" pot colors: ";
        pot_colors.forEach((el,index)=>{
            this.textColors.append(el.color_name);
            if(index!==pot_colors.length-1) this.textColors.append(", ");
        });
    }
    createIsAvailable(){
        this.isAvailable=document.createElement('span');
        this.isAvailable.classList.add('available');
        if(this.data.available==='true') {
            this.isAvailable.innerHTML="Available!";
            this.isAvailable.classList.add("available--true");
        }
        else {
            this.isAvailable.innerHTML="Sold out!";
            this.isAvailable.classList.add("available--false");
        }
    }
    setSlider(e){
        this.slider.style.marginLeft='-'+e.target.dataset.number*100+"%";
    }
}
let id=1;
const items=document.getElementById('items');
const more =document.getElementById('more');
const toggle=document.getElementById('toggleView');
const toggleAddPlant=document.getElementById('toggleAddPlant');
const toggleFilter=document.getElementById("toggleFilter");
const addPlant=document.getElementById('addPlant');
const addPlantForm=document.forms[0];
const filterForm=document.forms.filter;
addPlant.classList.add('hide');
filterForm.classList.add('hide');
addPlantForm.onsubmit=(e)=>{
    e.preventDefault();
    let plant_info={};
    plant_info.pot_colors=[];
    let req=checkRequired();
    let opt=checkOptional();
    if(req&&opt||req||opt) alert('you must fill all the required fields');
    else{
        if(!req){
            plant_info.id=plants.length;
            plant_info.name=addPlantForm.elements.addName.value;
            plant_info.price=addPlantForm.elements.addPrice.value+'$';
            plant_info.img=window.URL.createObjectURL(addPlantForm.elements.addImg.files[0]);
            plant_info.available='true';/*все добавленные вручную доступны к заказу, 
            т.к. мне лень пределывать форму*/
        }
        if(opt!==null&&opt!==true) {
            const color_names=document.querySelectorAll("[name^=potColorName]");
            const colors=document.querySelectorAll("[name^=potSwatch]");
            const imgs=document.querySelectorAll("[name^=potImg]");
            plant_info.pot_colors.push({
                color:colors[0].value,
                color_name:color_names[0].value,
                img:plant_info.img,
                default:true
            })
            for(let i=1;i<color_names.length;i++){
                let pot={}
                pot.color=colors[i].value;
                pot.color_name=color_names[i].value;
                pot.img=window.URL.createObjectURL(imgs[i-1].files[0]);
                plant_info.pot_colors.push(pot);
            }
        }
        console.log(plant_info);
        plants.push(plant_info);
        if(items.childNodes.length==plants.length-1) items.appendChild(new Plant(plant_info).element);
    }
}
toggle.onclick=(e)=>{
    e.target.classList.toggle("icofont-square");
    items.classList.toggle('list-view');
}
toggleAddPlant.onclick=()=>{
    addPlant.classList.toggle('show');
}
toggleFilter.onclick=()=>{
    filterForm.classList.toggle('show');
}
document.getElementById('addPot').onclick= function createPotForm(e){
    e.preventDefault();
    let pot_form=addPlantForm.elements.pot.cloneNode(true);
    pot_form.name+=id;
    for(let i=0;i<pot_form.elements.length;i++){
        let element=pot_form.elements[i];
        if(element.nodeName==="INPUT") {
            element.name+=id;
            element.parentNode.setAttribute('for',element.name);
        }
    }
    pot_form.elements.delImg.onclick=delImg;
    pot_form.elements.delImg.id+=id;
    const delPot=document.createElement('button');
    delPot.id='delPot'+id;
    delPot.innerHTML="-";
    delPot.onclick=deleteSelf;
    pot_form.appendChild(delPot);
    optional.appendChild(pot_form);
    id++;
}
document.getElementById('delImg').onclick=delImg;
document.getElementById('delImg0').onclick=delImg;
function deleteSelf(e) {
    e.preventDefault();
    e.target.parentNode.remove();
}
function delImg(ev){
    ev.preventDefault();
    ev.target.previousSibling.previousSibling.childNodes[1].value="";
}
function checkRequired(){//все обязательные заполнены?
    let isEmpty=false;
    const required=addPlantForm.required.elements;
    for(let i=0;i<required.length;i++){
        if(required[i].value===""&&required[i].nodeName==="INPUT"){
            return isEmpty=true;
        } 
    }
    return isEmpty;
}
function checkOptional(){//если одно заполнено, нужно заполнить остальные
    let isEmpty=false;
    const optional=addPlantForm.optional.elements;
    let countFilledOptional=0;
    for(let i=0;i<optional.length;i++){
        if(optional[i].value!==""&&optional[i].nodeName==="INPUT"&&optional[i].type!=="color") countFilledOptional++;
    }
    if(countFilledOptional>0) {
        for(let i=0;i<optional.length;i++){
            if(optional[i].value===""&&optional[i].nodeName==="INPUT"&&optional[i].type!=="color") return isEmpty=true;
        }   
    }
    else isEmpty=null;
    return isEmpty;
}
plants.slice(0,8).forEach(element => {
    let plant= new Plant(element);
    items.appendChild(plant.element);
});
more.onclick=(e)=>{
    let index=items.childNodes.length;
        plants.slice(index,index+8).forEach(element => {
            items.appendChild(new Plant(element).element);
        });
    if(items.childNodes.length>=plants.length) more.style.display="none";
};